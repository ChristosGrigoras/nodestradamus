# Dependency Graphs

This folder contains dependency graph data that AI tools use for impact analysis.

## Purpose

When you modify code, AI can check these graphs to understand:
- What functions call the one you're changing
- What files tend to change together
- What downstream code needs updating

## Graph Types

### Static Analysis Graphs

Generated by parsing code. Shows function/module dependencies.

| File | Source | Generator |
|------|--------|-----------|
| `python-deps.json` | Python code | `scripts/analyze_python_deps.py` or `pyan3` |
| `ts-deps.json` | TypeScript code | `madge` |
| `sql-deps.json` | SQL functions | Custom script |

### Co-occurrence Graph

Generated from git history. Shows files that change together.

| File | Source | Generator |
|------|--------|-----------|
| `co-occurrence.json` | Git history | `scripts/analyze_git_cooccurrence.py` |

## JSON Format

All graphs use this structure:

```json
{
  "nodes": ["src/api.py", "src/utils.py"],
  "edges": [
    {
      "from": "src/api.py::get_user",
      "to": "src/utils.py::validate",
      "type": "calls"
    }
  ],
  "metadata": {
    "generated_at": "2026-01-25T10:00:00Z",
    "generator": "analyze_python_deps.py"
  }
}
```

## Generating Graphs

### Python (using pyan3)

```bash
pip install pyan3
pyan3 src/**/*.py --json > .cursor/graph/python-deps.json
```

### Python (using custom script)

```bash
python scripts/analyze_python_deps.py src/ > .cursor/graph/python-deps.json
```

### TypeScript (using madge)

```bash
npm install -g madge
madge src/ --json > .cursor/graph/ts-deps.json
```

### Git Co-occurrence

```bash
python scripts/analyze_git_cooccurrence.py > .cursor/graph/co-occurrence.json
```

## CI Integration (Optional)

Add to `.github/workflows/update-graphs.yml`:

```yaml
name: Update Dependency Graphs

on:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - '*.py'
      - '*.ts'

jobs:
  update-graphs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 100  # For co-occurrence analysis
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Generate Python graph
        run: |
          pip install pyan3
          pyan3 src/**/*.py --json > .cursor/graph/python-deps.json || true
      
      - name: Generate co-occurrence graph
        run: python scripts/analyze_git_cooccurrence.py > .cursor/graph/co-occurrence.json
      
      - name: Commit graphs
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .cursor/graph/
          git commit -m "chore: update dependency graphs" || true
          git push
```

## When Graphs Are Missing

If this folder is empty, AI will fall back to:
1. Searching codebase for references
2. Checking import statements
3. Using git history directly

Graphs improve accuracy but aren't required.
