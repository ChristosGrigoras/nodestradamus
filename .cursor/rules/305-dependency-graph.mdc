---
description: Dependency graph awareness for impact analysis
globs: "**/*"
alwaysApply: false
---

# Dependency Graph

## Before Modifying Code

1. **Use Nodestradamus tools:** Run `get_impact` to identify what depends on the code you're modifying
2. **Note impacts:** List affected files in your response
3. **Update consumers:** Modify files that need to handle changes

## When Modifying Config Files

Config files (JSON, YAML, TOML, .env) don't have call graphs. Instead:

1. **Search for usage:** Grep for files that load/reference the config
2. **Check field usage:** If adding/removing fields, find code that accesses them
3. **Update consumers:** Modify files that need to handle changes

Example search patterns:
- `json.load` + filename
- `yaml.safe_load` + filename
- `os.getenv("FIELD_NAME")`
- Import statements referencing the config

## Response Format

When changes have downstream impacts:

```
## Impact Analysis

**Modified:** `src/utils.py::validate_order()`

**Downstream impacts:**
- `src/orders.py::create_order()` - calls validate_order()
- `src/payments.py::process_payment()` - calls validate_order()
- `tests/test_orders.py` - tests validate_order()

**Changes needed:** [list what needs updating]
```

## Nodestradamus MCP Tools

Use Nodestradamus tools for automated analysis:

```bash
# Quick reconnaissance (run first on unfamiliar repos)
nodestradamus project_scout /path/to/repo

# Build dependency graph
nodestradamus analyze_deps /path/to/repo

# Check impact before modifying a file
nodestradamus get_impact /path/to/repo path/to/file.py

# Find files that change together
nodestradamus analyze_cooccurrence /path/to/repo

# Full health check (dead code, duplicates, cycles, bottlenecks)
nodestradamus codebase_health /path/to/repo
```

## Manual Fallback

If Nodestradamus is not available:

1. Search codebase for function/file references
2. Check import statements
3. Use git history: `git log --all --full-history -- <file>`

## Limitations

- Config → code dependencies are implicit; search may miss some
- Dynamic calls (reflection, `getattr`) won't appear in static graphs
- Cross-repo dependencies not tracked

When uncertain, note it: "There may be additional callers not detected by static analysis."

## Bottleneck Files (This Repo)

Files with highest betweenness centrality — changes here have wide impact:

| File | Centrality | Description |
|------|------------|-------------|
| `nodestradamus/mcp/tools/graphs.py` | 0.030 | Central tool dispatcher |
| `nodestradamus/analyzers/code_parser.py` | 0.025 | AST parsing for all languages |
| `nodestradamus/analyzers/deps.py` | 0.020 | Core dependency extraction |
| `nodestradamus/analyzers/__init__.py` | 0.018 | Analyzer module exports |
| `nodestradamus/models/graph.py` | 0.007 | Graph data structures |
